<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mycom.campus_book.dao.ReservationDao">
	<insert id="insertReservation">
		<!-- ignore 主键冲突，报错 -->
		INSERT ignore INTO reservation (id, studentId)
		VALUES (#{id}, #{studentId})
	</insert>
	
	<select id="queryAndReturn"  resultType="org.mycom.campus_book.entity.Reservation">
		<!-- 如何告诉MyBatis把结果映射到Reservation同时映射sparetime属性 -->
		<!-- 可以自由控制SQL -->
		SELECT
			a.id,<!--mybatis会认为是id,又因为开启了驼峰命名法 所以最终是id -->
			a.studentId,
			a.time,
			b.id "sparetime.id",<!--b.id as "sparetime.id" 告诉mybatis b.id是sparetime中id属性的值-->
			b.teacherId "sparetime.teacherId",
			b.teacherName "sparetime.teacherName",
			b.startTime "sparetime.startTime",
			b.endTime "sparetime.endTime",
			b.maxReserved "sparetime.maxReserved",
			b.reserved "sparetime.reserved"
		FROM
			reservation a
		INNER JOIN sparetime b ON a.id = b.id
		WHERE 
		 	a.studentId=#{studentId}
	</select>
	
	<delete id="deleteReservation" >
    	DELETE FROM reservation WHERE id=#{id} and studentId=#{studentId} 
    </delete>  
    
    <select id="queryAll" resultType="org.mycom.campus_book.entity.Reservation">
		SELECT 
			a.id,<!--mybatis会认为是id,又因为开启了驼峰命名法 所以最终是id -->
			a.studentId,
			a.time,
			b.id "sparetime.id",<!--b.id as "sparetime.id" 告诉mybatis b.id是sparetime中id属性的值-->
			b.teacherId "sparetime.teacherId",
			b.teacherName "sparetime.teacherName",
			b.startTime "sparetime.startTime",
			b.endTime "sparetime.endTime",
			b.maxReserved "sparetime.maxReserved",
			b.reserved "sparetime.reserved"
		FROM
			reservation a
		INNER JOIN sparetime b ON a.id = b.id
		ORDER BY
			b.teacherId
		LIMIT #{offset}, #{limit}
	</select> 
	
	
	
</mapper>